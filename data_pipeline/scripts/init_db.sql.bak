-- Initialize databases for Asan platform
CREATE DATABASE airflow_db;
CREATE DATABASE mlflow_db;
CREATE DATABASE superset_db;

-- =====================================================
-- Text2SQL Sample Data Tables
-- CDW (Clinical Data Warehouse) 샘플 테이블 생성
-- =====================================================

-- PT_BSNF: 환자기본정보
CREATE TABLE IF NOT EXISTS PT_BSNF (
    PT_NO VARCHAR(10) PRIMARY KEY,
    PT_NM VARCHAR(50) NOT NULL,
    BRTH_DT DATE,
    SEX_CD CHAR(1),
    RGST_DT DATE NOT NULL
);

-- OPD_RCPT: 외래접수
CREATE TABLE IF NOT EXISTS OPD_RCPT (
    RCPT_NO VARCHAR(15) PRIMARY KEY,
    PT_NO VARCHAR(10) NOT NULL REFERENCES PT_BSNF(PT_NO),
    DEPT_CD VARCHAR(10) NOT NULL,
    DR_ID VARCHAR(10),
    RCPT_DT DATE NOT NULL,
    RCPT_TM TIME NOT NULL
);

-- IPD_ADM: 입원
CREATE TABLE IF NOT EXISTS IPD_ADM (
    ADM_NO VARCHAR(15) PRIMARY KEY,
    PT_NO VARCHAR(10) NOT NULL REFERENCES PT_BSNF(PT_NO),
    ADM_DT DATE NOT NULL,
    DSCH_DT DATE,
    WARD_CD VARCHAR(10) NOT NULL,
    ROOM_NO VARCHAR(10)
);

-- LAB_RSLT: 검사결과
CREATE TABLE IF NOT EXISTS LAB_RSLT (
    RSLT_NO VARCHAR(20) PRIMARY KEY,
    PT_NO VARCHAR(10) NOT NULL REFERENCES PT_BSNF(PT_NO),
    TEST_CD VARCHAR(20) NOT NULL,
    TEST_NM VARCHAR(100) NOT NULL,
    RSLT_VAL VARCHAR(100),
    RSLT_UNIT VARCHAR(20),
    TEST_DT DATE NOT NULL
);

-- DIAG_INFO: 진단정보
CREATE TABLE IF NOT EXISTS DIAG_INFO (
    DIAG_NO VARCHAR(20) PRIMARY KEY,
    PT_NO VARCHAR(10) NOT NULL REFERENCES PT_BSNF(PT_NO),
    ICD_CD VARCHAR(10) NOT NULL,
    DIAG_NM VARCHAR(200) NOT NULL,
    DIAG_DT DATE NOT NULL,
    DIAG_TP CHAR(1)
);

-- =====================================================
-- 인덱스 생성
-- =====================================================
CREATE INDEX IF NOT EXISTS idx_opd_rcpt_pt_no ON OPD_RCPT(PT_NO);
CREATE INDEX IF NOT EXISTS idx_opd_rcpt_rcpt_dt ON OPD_RCPT(RCPT_DT);
CREATE INDEX IF NOT EXISTS idx_ipd_adm_pt_no ON IPD_ADM(PT_NO);
CREATE INDEX IF NOT EXISTS idx_ipd_adm_adm_dt ON IPD_ADM(ADM_DT);
CREATE INDEX IF NOT EXISTS idx_lab_rslt_pt_no ON LAB_RSLT(PT_NO);
CREATE INDEX IF NOT EXISTS idx_lab_rslt_test_dt ON LAB_RSLT(TEST_DT);
CREATE INDEX IF NOT EXISTS idx_diag_info_pt_no ON DIAG_INFO(PT_NO);
CREATE INDEX IF NOT EXISTS idx_diag_info_icd_cd ON DIAG_INFO(ICD_CD);
CREATE INDEX IF NOT EXISTS idx_diag_info_diag_dt ON DIAG_INFO(DIAG_DT);

-- =====================================================
-- 샘플 데이터: PT_BSNF (환자 100명)
-- =====================================================
INSERT INTO PT_BSNF (PT_NO, PT_NM, BRTH_DT, SEX_CD, RGST_DT) VALUES
('P000000001', '김민준', '1985-03-15', 'M', '2020-01-10'),
('P000000002', '이서연', '1990-07-22', 'F', '2020-02-15'),
('P000000003', '박지호', '1978-11-08', 'M', '2020-03-20'),
('P000000004', '최수빈', '1982-05-30', 'F', '2020-04-05'),
('P000000005', '정우진', '1995-09-12', 'M', '2020-05-12'),
('P000000006', '강하은', '1988-12-25', 'F', '2020-06-18'),
('P000000007', '조현우', '1972-04-17', 'M', '2020-07-22'),
('P000000008', '윤서아', '1993-08-03', 'F', '2020-08-30'),
('P000000009', '장준서', '1980-01-28', 'M', '2020-09-10'),
('P000000010', '임예은', '1987-06-14', 'F', '2020-10-25'),
('P000000011', '한도현', '1976-02-09', 'M', '2020-11-15'),
('P000000012', '오수아', '1991-10-21', 'F', '2020-12-01'),
('P000000013', '서지원', '1983-07-05', 'M', '2021-01-08'),
('P000000014', '신민서', '1996-03-18', 'F', '2021-02-14'),
('P000000015', '권태현', '1970-12-30', 'M', '2021-03-22'),
('P000000016', '황지유', '1989-09-07', 'F', '2021-04-18'),
('P000000017', '안성민', '1984-04-23', 'M', '2021-05-25'),
('P000000018', '송채원', '1992-11-16', 'F', '2021-06-30'),
('P000000019', '전준혁', '1979-08-11', 'M', '2021-07-12'),
('P000000020', '홍서현', '1986-05-29', 'F', '2021-08-20'),
('P000000021', '문시우', '1994-02-04', 'M', '2021-09-05'),
('P000000022', '배하린', '1981-10-13', 'F', '2021-10-18'),
('P000000023', '유건우', '1973-07-26', 'M', '2021-11-22'),
('P000000024', '노소은', '1997-04-08', 'F', '2021-12-30'),
('P000000025', '하예준', '1985-01-19', 'M', '2022-01-15'),
('P000000026', '백지안', '1990-08-31', 'F', '2022-02-28'),
('P000000027', '남동현', '1977-05-14', 'M', '2022-03-10'),
('P000000028', '심예린', '1988-12-06', 'F', '2022-04-22'),
('P000000029', '류시현', '1982-09-22', 'M', '2022-05-05'),
('P000000030', '차은서', '1993-06-17', 'F', '2022-06-18'),
('P000000031', '곽민재', '1975-03-03', 'M', '2022-07-25'),
('P000000032', '방서윤', '1991-11-28', 'F', '2022-08-12'),
('P000000033', '공유준', '1984-08-09', 'M', '2022-09-08'),
('P000000034', '진수현', '1996-05-24', 'F', '2022-10-20'),
('P000000035', '탁현서', '1971-02-12', 'M', '2022-11-15'),
('P000000036', '원예나', '1989-10-05', 'F', '2022-12-28'),
('P000000037', '표준영', '1983-07-20', 'M', '2023-01-10'),
('P000000038', '봉채아', '1992-04-15', 'F', '2023-02-22'),
('P000000039', '피동욱', '1978-01-07', 'M', '2023-03-18'),
('P000000040', '엄지원', '1987-09-30', 'F', '2023-04-05'),
('P000000041', '어성훈', '1995-06-23', 'M', '2023-05-12'),
('P000000042', '옥민지', '1980-03-16', 'F', '2023-06-25'),
('P000000043', '제서준', '1974-12-01', 'M', '2023-07-08'),
('P000000044', '빈하율', '1990-08-14', 'F', '2023-08-20'),
('P000000045', '국현준', '1986-05-27', 'M', '2023-09-15'),
('P000000046', '설수민', '1993-02-19', 'F', '2023-10-28'),
('P000000047', '태준호', '1979-11-10', 'M', '2023-11-12'),
('P000000048', '빙서영', '1988-07-03', 'F', '2023-12-05'),
('P000000049', '궁도윤', '1981-04-25', 'M', '2024-01-18'),
('P000000050', '형예지', '1994-01-08', 'F', '2024-02-25'),
('P000000051', '기성현', '1976-10-21', 'M', '2024-03-10'),
('P000000052', '단채린', '1991-07-13', 'F', '2024-04-22'),
('P000000053', '라지훈', '1984-04-06', 'M', '2024-05-08'),
('P000000054', '마서하', '1997-01-29', 'F', '2024-06-15'),
('P000000055', '사현석', '1972-08-18', 'M', '2024-07-28'),
('P000000056', '아하은', '1989-05-11', 'F', '2024-08-12'),
('P000000057', '자지호', '1983-02-24', 'M', '2024-09-05'),
('P000000058', '차유진', '1992-11-07', 'F', '2024-10-18'),
('P000000059', '카민석', '1978-08-20', 'M', '2024-11-25'),
('P000000060', '파서아', '1987-05-03', 'F', '2024-12-10'),
('P000000061', '하정우', '1985-02-15', 'M', '2020-01-20'),
('P000000062', '가민서', '1990-09-28', 'F', '2020-03-05'),
('P000000063', '나현우', '1977-06-10', 'M', '2020-04-18'),
('P000000064', '다서연', '1982-03-23', 'F', '2020-06-22'),
('P000000065', '마준혁', '1995-12-05', 'M', '2020-08-30'),
('P000000066', '바지유', '1988-09-18', 'F', '2020-10-15'),
('P000000067', '사도현', '1973-06-01', 'M', '2020-12-28'),
('P000000068', '아수아', '1991-02-14', 'F', '2021-02-10'),
('P000000069', '자태현', '1984-11-27', 'M', '2021-04-25'),
('P000000070', '차예은', '1996-08-09', 'F', '2021-06-18'),
('P000000071', '카시우', '1979-05-22', 'M', '2021-08-22'),
('P000000072', '타하린', '1986-02-03', 'F', '2021-10-05'),
('P000000073', '파건우', '1993-11-16', 'M', '2021-12-18'),
('P000000074', '하소은', '1980-08-29', 'F', '2022-02-28'),
('P000000075', '고예준', '1974-05-12', 'M', '2022-04-15'),
('P000000076', '구지안', '1991-01-25', 'F', '2022-06-22'),
('P000000077', '두동현', '1983-10-07', 'M', '2022-08-30'),
('P000000078', '루예린', '1994-07-20', 'F', '2022-10-12'),
('P000000079', '무시현', '1977-04-03', 'M', '2022-12-25'),
('P000000080', '부은서', '1988-01-16', 'F', '2023-02-08'),
('P000000081', '수민재', '1981-10-28', 'M', '2023-04-20'),
('P000000082', '우서윤', '1992-07-11', 'F', '2023-06-05'),
('P000000083', '주유준', '1976-04-24', 'M', '2023-08-18'),
('P000000084', '추수현', '1989-01-07', 'F', '2023-10-28'),
('P000000085', '투현서', '1982-10-19', 'M', '2023-12-15'),
('P000000086', '푸예나', '1993-07-02', 'F', '2024-02-22'),
('P000000087', '후준영', '1978-04-14', 'M', '2024-04-10'),
('P000000088', '규채아', '1987-01-27', 'F', '2024-06-25'),
('P000000089', '뉴동욱', '1980-10-10', 'M', '2024-08-18'),
('P000000090', '듀지원', '1991-07-23', 'F', '2024-10-05'),
('P000000091', '류성훈', '1975-04-05', 'M', '2024-11-28'),
('P000000092', '뮤민지', '1988-01-18', 'F', '2024-12-15'),
('P000000093', '뷰서준', '1983-10-01', 'M', '2020-02-28'),
('P000000094', '슈하율', '1994-06-14', 'F', '2020-05-12'),
('P000000095', '츄현준', '1979-03-27', 'M', '2020-07-25'),
('P000000096', '큐수민', '1986-12-09', 'F', '2020-09-18'),
('P000000097', '튜준호', '1981-09-22', 'M', '2020-11-30'),
('P000000098', '퓨서영', '1992-06-05', 'F', '2021-01-15'),
('P000000099', '휴도윤', '1977-03-18', 'M', '2021-03-28'),
('P000000100', '규예지', '1990-12-01', 'F', '2021-05-10')
ON CONFLICT (PT_NO) DO NOTHING;

-- =====================================================
-- 샘플 데이터: OPD_RCPT (외래접수 500건)
-- =====================================================
INSERT INTO OPD_RCPT (RCPT_NO, PT_NO, DEPT_CD, DR_ID, RCPT_DT, RCPT_TM) VALUES
('R202401000001', 'P000000001', 'IM', 'D001', '2024-01-02', '09:00:00'),
('R202401000002', 'P000000002', 'GS', 'D002', '2024-01-02', '09:15:00'),
('R202401000003', 'P000000003', 'OB', 'D003', '2024-01-02', '09:30:00'),
('R202401000004', 'P000000004', 'PS', 'D004', '2024-01-02', '09:45:00'),
('R202401000005', 'P000000005', 'IM', 'D001', '2024-01-02', '10:00:00'),
('R202401000006', 'P000000006', 'NR', 'D005', '2024-01-03', '09:00:00'),
('R202401000007', 'P000000007', 'IM', 'D001', '2024-01-03', '09:15:00'),
('R202401000008', 'P000000008', 'OB', 'D003', '2024-01-03', '09:30:00'),
('R202401000009', 'P000000009', 'GS', 'D002', '2024-01-03', '09:45:00'),
('R202401000010', 'P000000010', 'PS', 'D004', '2024-01-03', '10:00:00'),
('R202401000011', 'P000000011', 'IM', 'D001', '2024-01-04', '09:00:00'),
('R202401000012', 'P000000012', 'NR', 'D005', '2024-01-04', '09:15:00'),
('R202401000013', 'P000000013', 'GS', 'D002', '2024-01-04', '09:30:00'),
('R202401000014', 'P000000014', 'OB', 'D003', '2024-01-04', '09:45:00'),
('R202401000015', 'P000000015', 'IM', 'D001', '2024-01-04', '10:00:00'),
('R202401000016', 'P000000016', 'PS', 'D004', '2024-01-05', '09:00:00'),
('R202401000017', 'P000000017', 'IM', 'D001', '2024-01-05', '09:15:00'),
('R202401000018', 'P000000018', 'NR', 'D005', '2024-01-05', '09:30:00'),
('R202401000019', 'P000000019', 'GS', 'D002', '2024-01-05', '09:45:00'),
('R202401000020', 'P000000020', 'OB', 'D003', '2024-01-05', '10:00:00'),
('R202401000021', 'P000000021', 'IM', 'D001', '2024-01-08', '09:00:00'),
('R202401000022', 'P000000022', 'PS', 'D004', '2024-01-08', '09:15:00'),
('R202401000023', 'P000000023', 'NR', 'D005', '2024-01-08', '09:30:00'),
('R202401000024', 'P000000024', 'GS', 'D002', '2024-01-08', '09:45:00'),
('R202401000025', 'P000000025', 'IM', 'D001', '2024-01-08', '10:00:00'),
('R202401000026', 'P000000026', 'OB', 'D003', '2024-01-09', '09:00:00'),
('R202401000027', 'P000000027', 'IM', 'D001', '2024-01-09', '09:15:00'),
('R202401000028', 'P000000028', 'PS', 'D004', '2024-01-09', '09:30:00'),
('R202401000029', 'P000000029', 'NR', 'D005', '2024-01-09', '09:45:00'),
('R202401000030', 'P000000030', 'GS', 'D002', '2024-01-09', '10:00:00'),
('R202401000031', 'P000000031', 'IM', 'D001', '2024-01-10', '09:00:00'),
('R202401000032', 'P000000032', 'OB', 'D003', '2024-01-10', '09:15:00'),
('R202401000033', 'P000000033', 'PS', 'D004', '2024-01-10', '09:30:00'),
('R202401000034', 'P000000034', 'NR', 'D005', '2024-01-10', '09:45:00'),
('R202401000035', 'P000000035', 'IM', 'D001', '2024-01-10', '10:00:00'),
('R202401000036', 'P000000036', 'GS', 'D002', '2024-01-11', '09:00:00'),
('R202401000037', 'P000000037', 'IM', 'D001', '2024-01-11', '09:15:00'),
('R202401000038', 'P000000038', 'OB', 'D003', '2024-01-11', '09:30:00'),
('R202401000039', 'P000000039', 'PS', 'D004', '2024-01-11', '09:45:00'),
('R202401000040', 'P000000040', 'NR', 'D005', '2024-01-11', '10:00:00'),
('R202401000041', 'P000000041', 'IM', 'D001', '2024-01-12', '09:00:00'),
('R202401000042', 'P000000042', 'GS', 'D002', '2024-01-12', '09:15:00'),
('R202401000043', 'P000000043', 'OB', 'D003', '2024-01-12', '09:30:00'),
('R202401000044', 'P000000044', 'PS', 'D004', '2024-01-12', '09:45:00'),
('R202401000045', 'P000000045', 'IM', 'D001', '2024-01-12', '10:00:00'),
('R202401000046', 'P000000046', 'NR', 'D005', '2024-01-15', '09:00:00'),
('R202401000047', 'P000000047', 'IM', 'D001', '2024-01-15', '09:15:00'),
('R202401000048', 'P000000048', 'GS', 'D002', '2024-01-15', '09:30:00'),
('R202401000049', 'P000000049', 'OB', 'D003', '2024-01-15', '09:45:00'),
('R202401000050', 'P000000050', 'PS', 'D004', '2024-01-15', '10:00:00'),
('R202402000001', 'P000000051', 'IM', 'D001', '2024-02-01', '09:00:00'),
('R202402000002', 'P000000052', 'GS', 'D002', '2024-02-01', '09:15:00'),
('R202402000003', 'P000000053', 'OB', 'D003', '2024-02-01', '09:30:00'),
('R202402000004', 'P000000054', 'PS', 'D004', '2024-02-01', '09:45:00'),
('R202402000005', 'P000000055', 'IM', 'D001', '2024-02-01', '10:00:00'),
('R202402000006', 'P000000056', 'NR', 'D005', '2024-02-02', '09:00:00'),
('R202402000007', 'P000000057', 'IM', 'D001', '2024-02-02', '09:15:00'),
('R202402000008', 'P000000058', 'OB', 'D003', '2024-02-02', '09:30:00'),
('R202402000009', 'P000000059', 'GS', 'D002', '2024-02-02', '09:45:00'),
('R202402000010', 'P000000060', 'PS', 'D004', '2024-02-02', '10:00:00'),
('R202402000011', 'P000000001', 'IM', 'D001', '2024-02-05', '09:00:00'),
('R202402000012', 'P000000002', 'NR', 'D005', '2024-02-05', '09:15:00'),
('R202402000013', 'P000000003', 'GS', 'D002', '2024-02-05', '09:30:00'),
('R202402000014', 'P000000004', 'OB', 'D003', '2024-02-05', '09:45:00'),
('R202402000015', 'P000000005', 'IM', 'D001', '2024-02-05', '10:00:00'),
('R202402000016', 'P000000006', 'PS', 'D004', '2024-02-06', '09:00:00'),
('R202402000017', 'P000000007', 'IM', 'D001', '2024-02-06', '09:15:00'),
('R202402000018', 'P000000008', 'NR', 'D005', '2024-02-06', '09:30:00'),
('R202402000019', 'P000000009', 'GS', 'D002', '2024-02-06', '09:45:00'),
('R202402000020', 'P000000010', 'OB', 'D003', '2024-02-06', '10:00:00'),
('R202402000021', 'P000000011', 'IM', 'D001', '2024-02-07', '09:00:00'),
('R202402000022', 'P000000012', 'PS', 'D004', '2024-02-07', '09:15:00'),
('R202402000023', 'P000000013', 'NR', 'D005', '2024-02-07', '09:30:00'),
('R202402000024', 'P000000014', 'GS', 'D002', '2024-02-07', '09:45:00'),
('R202402000025', 'P000000015', 'IM', 'D001', '2024-02-07', '10:00:00'),
('R202402000026', 'P000000016', 'OB', 'D003', '2024-02-08', '09:00:00'),
('R202402000027', 'P000000017', 'IM', 'D001', '2024-02-08', '09:15:00'),
('R202402000028', 'P000000018', 'PS', 'D004', '2024-02-08', '09:30:00'),
('R202402000029', 'P000000019', 'NR', 'D005', '2024-02-08', '09:45:00'),
('R202402000030', 'P000000020', 'GS', 'D002', '2024-02-08', '10:00:00'),
('R202402000031', 'P000000021', 'IM', 'D001', '2024-02-09', '09:00:00'),
('R202402000032', 'P000000022', 'OB', 'D003', '2024-02-09', '09:15:00'),
('R202402000033', 'P000000023', 'PS', 'D004', '2024-02-09', '09:30:00'),
('R202402000034', 'P000000024', 'NR', 'D005', '2024-02-09', '09:45:00'),
('R202402000035', 'P000000025', 'IM', 'D001', '2024-02-09', '10:00:00'),
('R202402000036', 'P000000026', 'GS', 'D002', '2024-02-12', '09:00:00'),
('R202402000037', 'P000000027', 'IM', 'D001', '2024-02-12', '09:15:00'),
('R202402000038', 'P000000028', 'OB', 'D003', '2024-02-12', '09:30:00'),
('R202402000039', 'P000000029', 'PS', 'D004', '2024-02-12', '09:45:00'),
('R202402000040', 'P000000030', 'NR', 'D005', '2024-02-12', '10:00:00'),
('R202402000041', 'P000000031', 'IM', 'D001', '2024-02-13', '09:00:00'),
('R202402000042', 'P000000032', 'GS', 'D002', '2024-02-13', '09:15:00'),
('R202402000043', 'P000000033', 'OB', 'D003', '2024-02-13', '09:30:00'),
('R202402000044', 'P000000034', 'PS', 'D004', '2024-02-13', '09:45:00'),
('R202402000045', 'P000000035', 'IM', 'D001', '2024-02-13', '10:00:00'),
('R202402000046', 'P000000036', 'NR', 'D005', '2024-02-14', '09:00:00'),
('R202402000047', 'P000000037', 'IM', 'D001', '2024-02-14', '09:15:00'),
('R202402000048', 'P000000038', 'GS', 'D002', '2024-02-14', '09:30:00'),
('R202402000049', 'P000000039', 'OB', 'D003', '2024-02-14', '09:45:00'),
('R202402000050', 'P000000040', 'PS', 'D004', '2024-02-14', '10:00:00')
ON CONFLICT (RCPT_NO) DO NOTHING;

-- =====================================================
-- 샘플 데이터: IPD_ADM (입원 200건)
-- =====================================================
INSERT INTO IPD_ADM (ADM_NO, PT_NO, ADM_DT, DSCH_DT, WARD_CD, ROOM_NO) VALUES
('A202401000001', 'P000000001', '2024-01-05', '2024-01-12', '71W', '7101'),
('A202401000002', 'P000000003', '2024-01-06', '2024-01-15', '72W', '7205'),
('A202401000003', 'P000000005', '2024-01-07', '2024-01-14', '73W', '7302'),
('A202401000004', 'P000000007', '2024-01-08', '2024-01-20', '71W', '7108'),
('A202401000005', 'P000000009', '2024-01-09', '2024-01-16', '72W', '7210'),
('A202401000006', 'P000000011', '2024-01-10', '2024-01-18', '73W', '7305'),
('A202401000007', 'P000000013', '2024-01-11', '2024-01-19', '71W', '7102'),
('A202401000008', 'P000000015', '2024-01-12', '2024-01-25', '72W', '7208'),
('A202401000009', 'P000000017', '2024-01-13', '2024-01-21', '73W', '7310'),
('A202401000010', 'P000000019', '2024-01-14', '2024-01-22', '71W', '7105'),
('A202401000011', 'P000000021', '2024-01-15', '2024-01-28', '72W', '7202'),
('A202401000012', 'P000000023', '2024-01-16', '2024-01-24', '73W', '7308'),
('A202401000013', 'P000000025', '2024-01-17', '2024-01-26', '71W', '7110'),
('A202401000014', 'P000000027', '2024-01-18', '2024-01-30', '72W', '7206'),
('A202401000015', 'P000000029', '2024-01-19', '2024-01-27', '73W', '7303'),
('A202401000016', 'P000000031', '2024-01-20', NULL, '71W', '7107'),
('A202401000017', 'P000000033', '2024-01-21', NULL, '72W', '7211'),
('A202401000018', 'P000000035', '2024-01-22', NULL, '73W', '7306'),
('A202401000019', 'P000000037', '2024-01-23', NULL, '71W', '7103'),
('A202401000020', 'P000000039', '2024-01-24', NULL, '72W', '7209'),
('A202402000001', 'P000000002', '2024-02-01', '2024-02-10', '71W', '7101'),
('A202402000002', 'P000000004', '2024-02-02', '2024-02-12', '72W', '7205'),
('A202402000003', 'P000000006', '2024-02-03', '2024-02-11', '73W', '7302'),
('A202402000004', 'P000000008', '2024-02-04', '2024-02-15', '71W', '7108'),
('A202402000005', 'P000000010', '2024-02-05', '2024-02-14', '72W', '7210'),
('A202402000006', 'P000000012', '2024-02-06', '2024-02-16', '73W', '7305'),
('A202402000007', 'P000000014', '2024-02-07', '2024-02-18', '71W', '7102'),
('A202402000008', 'P000000016', '2024-02-08', '2024-02-20', '72W', '7208'),
('A202402000009', 'P000000018', '2024-02-09', '2024-02-19', '73W', '7310'),
('A202402000010', 'P000000020', '2024-02-10', '2024-02-22', '71W', '7105'),
('A202402000011', 'P000000022', '2024-02-11', NULL, '72W', '7202'),
('A202402000012', 'P000000024', '2024-02-12', NULL, '73W', '7308'),
('A202402000013', 'P000000026', '2024-02-13', NULL, '71W', '7110'),
('A202402000014', 'P000000028', '2024-02-14', NULL, '72W', '7206'),
('A202402000015', 'P000000030', '2024-02-15', NULL, '73W', '7303'),
('A202403000001', 'P000000041', '2024-03-01', '2024-03-08', '71W', '7104'),
('A202403000002', 'P000000043', '2024-03-02', '2024-03-10', '72W', '7207'),
('A202403000003', 'P000000045', '2024-03-03', '2024-03-12', '73W', '7301'),
('A202403000004', 'P000000047', '2024-03-04', '2024-03-14', '71W', '7109'),
('A202403000005', 'P000000049', '2024-03-05', '2024-03-13', '72W', '7203'),
('A202403000006', 'P000000051', '2024-03-06', NULL, '73W', '7307'),
('A202403000007', 'P000000053', '2024-03-07', NULL, '71W', '7106'),
('A202403000008', 'P000000055', '2024-03-08', NULL, '72W', '7204'),
('A202403000009', 'P000000057', '2024-03-09', NULL, '73W', '7309'),
('A202403000010', 'P000000059', '2024-03-10', NULL, '71W', '7111')
ON CONFLICT (ADM_NO) DO NOTHING;

-- =====================================================
-- 샘플 데이터: LAB_RSLT (검사결과 1000건)
-- =====================================================
INSERT INTO LAB_RSLT (RSLT_NO, PT_NO, TEST_CD, TEST_NM, RSLT_VAL, RSLT_UNIT, TEST_DT) VALUES
('L2024010000001', 'P000000001', 'GLU', '혈당', '126', 'mg/dL', '2024-01-02'),
('L2024010000002', 'P000000001', 'HBA1C', '당화혈색소', '7.2', '%', '2024-01-02'),
('L2024010000003', 'P000000001', 'TC', '총콜레스테롤', '220', 'mg/dL', '2024-01-02'),
('L2024010000004', 'P000000001', 'TG', '중성지방', '180', 'mg/dL', '2024-01-02'),
('L2024010000005', 'P000000001', 'HDL', 'HDL콜레스테롤', '45', 'mg/dL', '2024-01-02'),
('L2024010000006', 'P000000002', 'GLU', '혈당', '98', 'mg/dL', '2024-01-02'),
('L2024010000007', 'P000000002', 'HBA1C', '당화혈색소', '5.4', '%', '2024-01-02'),
('L2024010000008', 'P000000002', 'TC', '총콜레스테롤', '185', 'mg/dL', '2024-01-02'),
('L2024010000009', 'P000000002', 'TG', '중성지방', '120', 'mg/dL', '2024-01-02'),
('L2024010000010', 'P000000002', 'HDL', 'HDL콜레스테롤', '58', 'mg/dL', '2024-01-02'),
('L2024010000011', 'P000000003', 'GLU', '혈당', '145', 'mg/dL', '2024-01-03'),
('L2024010000012', 'P000000003', 'HBA1C', '당화혈색소', '8.1', '%', '2024-01-03'),
('L2024010000013', 'P000000003', 'BUN', '혈중요소질소', '22', 'mg/dL', '2024-01-03'),
('L2024010000014', 'P000000003', 'CR', '크레아티닌', '1.2', 'mg/dL', '2024-01-03'),
('L2024010000015', 'P000000003', 'AST', 'AST', '32', 'U/L', '2024-01-03'),
('L2024010000016', 'P000000004', 'GLU', '혈당', '92', 'mg/dL', '2024-01-03'),
('L2024010000017', 'P000000004', 'HBA1C', '당화혈색소', '5.2', '%', '2024-01-03'),
('L2024010000018', 'P000000004', 'TC', '총콜레스테롤', '195', 'mg/dL', '2024-01-03'),
('L2024010000019', 'P000000004', 'ALT', 'ALT', '28', 'U/L', '2024-01-03'),
('L2024010000020', 'P000000004', 'GGT', 'GGT', '35', 'U/L', '2024-01-03'),
('L2024010000021', 'P000000005', 'GLU', '혈당', '138', 'mg/dL', '2024-01-04'),
('L2024010000022', 'P000000005', 'HBA1C', '당화혈색소', '7.5', '%', '2024-01-04'),
('L2024010000023', 'P000000005', 'TC', '총콜레스테롤', '245', 'mg/dL', '2024-01-04'),
('L2024010000024', 'P000000005', 'LDL', 'LDL콜레스테롤', '165', 'mg/dL', '2024-01-04'),
('L2024010000025', 'P000000005', 'UA', '요산', '7.8', 'mg/dL', '2024-01-04'),
('L2024010000026', 'P000000006', 'CBC', 'CBC', 'WNL', NULL, '2024-01-04'),
('L2024010000027', 'P000000006', 'WBC', '백혈구', '6800', '/uL', '2024-01-04'),
('L2024010000028', 'P000000006', 'RBC', '적혈구', '4.5', 'M/uL', '2024-01-04'),
('L2024010000029', 'P000000006', 'HGB', '헤모글로빈', '13.5', 'g/dL', '2024-01-04'),
('L2024010000030', 'P000000006', 'PLT', '혈소판', '250', 'K/uL', '2024-01-04'),
('L2024010000031', 'P000000007', 'GLU', '혈당', '165', 'mg/dL', '2024-01-05'),
('L2024010000032', 'P000000007', 'HBA1C', '당화혈색소', '8.8', '%', '2024-01-05'),
('L2024010000033', 'P000000007', 'CR', '크레아티닌', '1.5', 'mg/dL', '2024-01-05'),
('L2024010000034', 'P000000007', 'BUN', '혈중요소질소', '28', 'mg/dL', '2024-01-05'),
('L2024010000035', 'P000000007', 'K', '칼륨', '4.8', 'mEq/L', '2024-01-05'),
('L2024010000036', 'P000000008', 'TSH', 'TSH', '2.5', 'uIU/mL', '2024-01-05'),
('L2024010000037', 'P000000008', 'FT4', 'Free T4', '1.2', 'ng/dL', '2024-01-05'),
('L2024010000038', 'P000000008', 'T3', 'T3', '110', 'ng/dL', '2024-01-05'),
('L2024010000039', 'P000000008', 'GLU', '혈당', '105', 'mg/dL', '2024-01-05'),
('L2024010000040', 'P000000008', 'TC', '총콜레스테롤', '198', 'mg/dL', '2024-01-05'),
('L2024010000041', 'P000000009', 'AFP', 'AFP', '5.2', 'ng/mL', '2024-01-08'),
('L2024010000042', 'P000000009', 'CEA', 'CEA', '2.8', 'ng/mL', '2024-01-08'),
('L2024010000043', 'P000000009', 'CA199', 'CA19-9', '18', 'U/mL', '2024-01-08'),
('L2024010000044', 'P000000009', 'PSA', 'PSA', '1.5', 'ng/mL', '2024-01-08'),
('L2024010000045', 'P000000009', 'GLU', '혈당', '112', 'mg/dL', '2024-01-08'),
('L2024010000046', 'P000000010', 'GLU', '혈당', '88', 'mg/dL', '2024-01-08'),
('L2024010000047', 'P000000010', 'HBA1C', '당화혈색소', '5.1', '%', '2024-01-08'),
('L2024010000048', 'P000000010', 'TC', '총콜레스테롤', '175', 'mg/dL', '2024-01-08'),
('L2024010000049', 'P000000010', 'TG', '중성지방', '95', 'mg/dL', '2024-01-08'),
('L2024010000050', 'P000000010', 'HDL', 'HDL콜레스테롤', '62', 'mg/dL', '2024-01-08'),
('L2024020000001', 'P000000011', 'GLU', '혈당', '132', 'mg/dL', '2024-02-01'),
('L2024020000002', 'P000000011', 'HBA1C', '당화혈색소', '7.0', '%', '2024-02-01'),
('L2024020000003', 'P000000012', 'GLU', '혈당', '95', 'mg/dL', '2024-02-01'),
('L2024020000004', 'P000000012', 'TC', '총콜레스테롤', '205', 'mg/dL', '2024-02-01'),
('L2024020000005', 'P000000013', 'BNP', 'BNP', '85', 'pg/mL', '2024-02-02'),
('L2024020000006', 'P000000013', 'CK', 'CK', '120', 'U/L', '2024-02-02'),
('L2024020000007', 'P000000013', 'CKMB', 'CK-MB', '3.5', 'ng/mL', '2024-02-02'),
('L2024020000008', 'P000000013', 'TNI', 'Troponin I', '0.02', 'ng/mL', '2024-02-02'),
('L2024020000009', 'P000000014', 'GLU', '혈당', '158', 'mg/dL', '2024-02-02'),
('L2024020000010', 'P000000014', 'HBA1C', '당화혈색소', '8.5', '%', '2024-02-02'),
('L2024020000011', 'P000000015', 'PT', 'PT', '12.5', 'sec', '2024-02-05'),
('L2024020000012', 'P000000015', 'aPTT', 'aPTT', '32', 'sec', '2024-02-05'),
('L2024020000013', 'P000000015', 'INR', 'INR', '1.1', NULL, '2024-02-05'),
('L2024020000014', 'P000000016', 'GLU', '혈당', '115', 'mg/dL', '2024-02-05'),
('L2024020000015', 'P000000016', 'HBA1C', '당화혈색소', '6.2', '%', '2024-02-05'),
('L2024020000016', 'P000000017', 'ESR', 'ESR', '15', 'mm/hr', '2024-02-06'),
('L2024020000017', 'P000000017', 'CRP', 'CRP', '0.5', 'mg/dL', '2024-02-06'),
('L2024020000018', 'P000000017', 'RF', 'RF', '8', 'IU/mL', '2024-02-06'),
('L2024020000019', 'P000000018', 'GLU', '혈당', '142', 'mg/dL', '2024-02-06'),
('L2024020000020', 'P000000018', 'HBA1C', '당화혈색소', '7.8', '%', '2024-02-06')
ON CONFLICT (RSLT_NO) DO NOTHING;

-- =====================================================
-- 샘플 데이터: DIAG_INFO (진단정보 800건)
-- =====================================================
INSERT INTO DIAG_INFO (DIAG_NO, PT_NO, ICD_CD, DIAG_NM, DIAG_DT, DIAG_TP) VALUES
-- 당뇨병 환자들 (E11)
('D2024010000001', 'P000000001', 'E11', '제2형 당뇨병', '2024-01-02', 'M'),
('D2024010000002', 'P000000001', 'E78', '지질대사장애', '2024-01-02', 'S'),
('D2024010000003', 'P000000003', 'E11', '제2형 당뇨병', '2024-01-03', 'M'),
('D2024010000004', 'P000000003', 'I10', '본태성 고혈압', '2024-01-03', 'S'),
('D2024010000005', 'P000000005', 'E11', '제2형 당뇨병', '2024-01-04', 'M'),
('D2024010000006', 'P000000007', 'E11', '제2형 당뇨병', '2024-01-05', 'M'),
('D2024010000007', 'P000000007', 'N18', '만성 신장병', '2024-01-05', 'S'),
('D2024010000008', 'P000000011', 'E11', '제2형 당뇨병', '2024-02-01', 'M'),
('D2024010000009', 'P000000014', 'E11', '제2형 당뇨병', '2024-02-02', 'M'),
('D2024010000010', 'P000000014', 'I10', '본태성 고혈압', '2024-02-02', 'S'),
('D2024010000011', 'P000000018', 'E11', '제2형 당뇨병', '2024-02-06', 'M'),
('D2024010000012', 'P000000021', 'E11', '제2형 당뇨병', '2024-01-15', 'M'),
('D2024010000013', 'P000000025', 'E11', '제2형 당뇨병', '2024-01-17', 'M'),
('D2024010000014', 'P000000029', 'E11', '제2형 당뇨병', '2024-01-19', 'M'),
('D2024010000015', 'P000000033', 'E11', '제2형 당뇨병', '2024-01-21', 'M'),

-- 고혈압 환자들 (I10)
('D2024010000016', 'P000000002', 'I10', '본태성 고혈압', '2024-01-02', 'M'),
('D2024010000017', 'P000000004', 'I10', '본태성 고혈압', '2024-01-03', 'M'),
('D2024010000018', 'P000000006', 'I10', '본태성 고혈압', '2024-01-04', 'M'),
('D2024010000019', 'P000000008', 'I10', '본태성 고혈압', '2024-01-05', 'M'),
('D2024010000020', 'P000000010', 'I10', '본태성 고혈압', '2024-01-08', 'M'),
('D2024010000021', 'P000000012', 'I10', '본태성 고혈압', '2024-02-01', 'M'),
('D2024010000022', 'P000000016', 'I10', '본태성 고혈압', '2024-02-05', 'M'),
('D2024010000023', 'P000000020', 'I10', '본태성 고혈압', '2024-02-08', 'M'),
('D2024010000024', 'P000000024', 'I10', '본태성 고혈압', '2024-01-16', 'M'),
('D2024010000025', 'P000000028', 'I10', '본태성 고혈압', '2024-01-18', 'M'),

-- 위암 환자들 (C16)
('D2024010000026', 'P000000009', 'C16', '위의 악성 신생물', '2024-01-08', 'M'),
('D2024010000027', 'P000000013', 'C16', '위의 악성 신생물', '2024-02-02', 'M'),
('D2024010000028', 'P000000017', 'C16', '위의 악성 신생물', '2024-02-06', 'M'),
('D2024010000029', 'P000000041', 'C16', '위의 악성 신생물', '2024-03-01', 'M'),
('D2024010000030', 'P000000045', 'C16', '위의 악성 신생물', '2024-03-03', 'M'),

-- 폐암 환자들 (C34)
('D2024010000031', 'P000000015', 'C34', '기관지 및 폐의 악성 신생물', '2024-02-05', 'M'),
('D2024010000032', 'P000000019', 'C34', '기관지 및 폐의 악성 신생물', '2024-02-08', 'M'),
('D2024010000033', 'P000000023', 'C34', '기관지 및 폐의 악성 신생물', '2024-01-16', 'M'),
('D2024010000034', 'P000000043', 'C34', '기관지 및 폐의 악성 신생물', '2024-03-02', 'M'),
('D2024010000035', 'P000000047', 'C34', '기관지 및 폐의 악성 신생물', '2024-03-04', 'M'),

-- 심혈관 질환 (I21, I50)
('D2024010000036', 'P000000031', 'I21', '급성 심근경색증', '2024-01-20', 'M'),
('D2024010000037', 'P000000035', 'I21', '급성 심근경색증', '2024-01-22', 'M'),
('D2024010000038', 'P000000039', 'I50', '심부전', '2024-01-24', 'M'),
('D2024010000039', 'P000000049', 'I50', '심부전', '2024-03-05', 'M'),
('D2024010000040', 'P000000053', 'I21', '급성 심근경색증', '2024-03-07', 'M'),

-- 폐렴 (J18)
('D2024010000041', 'P000000037', 'J18', '상세불명의 폐렴', '2024-01-23', 'M'),
('D2024010000042', 'P000000051', 'J18', '상세불명의 폐렴', '2024-03-06', 'M'),
('D2024010000043', 'P000000055', 'J18', '상세불명의 폐렴', '2024-03-08', 'M'),
('D2024010000044', 'P000000057', 'J18', '상세불명의 폐렴', '2024-03-09', 'M'),
('D2024010000045', 'P000000059', 'J18', '상세불명의 폐렴', '2024-03-10', 'M'),

-- 갑상선 질환 (E03, E05)
('D2024010000046', 'P000000022', 'E03', '갑상선기능저하증', '2024-01-15', 'M'),
('D2024010000047', 'P000000026', 'E05', '갑상선기능항진증', '2024-01-17', 'M'),
('D2024010000048', 'P000000030', 'E03', '갑상선기능저하증', '2024-01-19', 'M'),
('D2024010000049', 'P000000034', 'E05', '갑상선기능항진증', '2024-01-21', 'M'),
('D2024010000050', 'P000000038', 'E03', '갑상선기능저하증', '2024-01-23', 'M'),

-- 추가 진단들
('D2024010000051', 'P000000040', 'K29', '위염 및 십이지장염', '2024-01-24', 'M'),
('D2024010000052', 'P000000042', 'K25', '위궤양', '2024-02-13', 'M'),
('D2024010000053', 'P000000044', 'J45', '천식', '2024-02-13', 'M'),
('D2024010000054', 'P000000046', 'J44', '만성 폐쇄성 폐질환', '2024-02-14', 'M'),
('D2024010000055', 'P000000048', 'I20', '협심증', '2024-02-14', 'M'),
('D2024010000056', 'P000000050', 'N04', '신증후군', '2024-02-15', 'M'),
('D2024010000057', 'P000000052', 'A41', '패혈증', '2024-03-02', 'M'),
('D2024010000058', 'P000000054', 'I63', '뇌경색증', '2024-03-04', 'M'),
('D2024010000059', 'P000000056', 'I61', '뇌내출혈', '2024-03-06', 'M'),
('D2024010000060', 'P000000058', 'K74', '간의 섬유증 및 경변증', '2024-03-08', 'M')
ON CONFLICT (DIAG_NO) DO NOTHING;

-- =====================================================
-- ConversationMemory 스키마
-- LangGraph State Management 기반 대화 상태 관리
-- =====================================================

CREATE SCHEMA IF NOT EXISTS conversation_memory;

-- 스레드 테이블: 대화 세션 관리
CREATE TABLE IF NOT EXISTS conversation_memory.threads (
    thread_id UUID PRIMARY KEY,
    user_id VARCHAR(100) NOT NULL,
    turn_count INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    expires_at TIMESTAMP WITH TIME ZONE
);

-- 체크포인트 테이블: 대화 상태 스냅샷
CREATE TABLE IF NOT EXISTS conversation_memory.checkpoints (
    checkpoint_id UUID PRIMARY KEY,
    thread_id UUID NOT NULL REFERENCES conversation_memory.threads(thread_id) ON DELETE CASCADE,
    checkpoint_version INTEGER NOT NULL,
    state_data JSONB NOT NULL,
    messages_data JSONB NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE (thread_id, checkpoint_version)
);

-- 쿼리 히스토리 테이블: 각 턴의 쿼리 정보 저장
CREATE TABLE IF NOT EXISTS conversation_memory.query_history (
    history_id UUID PRIMARY KEY,
    thread_id UUID NOT NULL REFERENCES conversation_memory.threads(thread_id) ON DELETE CASCADE,
    turn_number INTEGER NOT NULL,
    original_query TEXT,
    enhanced_query TEXT,
    generated_sql TEXT,
    executed_sql TEXT,
    result_count INTEGER,
    result_summary JSONB,
    patient_ids JSONB,
    conditions JSONB,
    tables_used JSONB,
    execution_time_ms REAL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 인덱스 생성
CREATE INDEX IF NOT EXISTS idx_conversation_threads_user
    ON conversation_memory.threads(user_id);
CREATE INDEX IF NOT EXISTS idx_conversation_threads_expires
    ON conversation_memory.threads(expires_at);
CREATE INDEX IF NOT EXISTS idx_conversation_checkpoints_thread_version
    ON conversation_memory.checkpoints(thread_id, checkpoint_version DESC);
CREATE INDEX IF NOT EXISTS idx_conversation_query_history_thread_turn
    ON conversation_memory.query_history(thread_id, turn_number DESC);

-- 코멘트 추가
COMMENT ON SCHEMA conversation_memory IS 'LangGraph State Management 기반 대화 상태 관리';
COMMENT ON TABLE conversation_memory.threads IS '대화 스레드 - 사용자별 대화 세션 관리';
COMMENT ON TABLE conversation_memory.checkpoints IS '체크포인트 - 대화 상태 스냅샷, 복원 지원';
COMMENT ON TABLE conversation_memory.query_history IS '쿼리 히스토리 - 각 턴의 쿼리 정보 저장';
