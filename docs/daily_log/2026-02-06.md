# 2026-02-06 (목) — 대규모 재구조화 + 데모 기능

> 커밋 2건 / +100,412줄 / -4,111줄 / 파일 240개 변경

---

## 1. 프로젝트 대규모 재구조화 `8b4aa37`

**170파일 변경 (+12,971 / -2,137)**

기존 `src/`, `doc/`, `docker/` 단일 구조를 기능별 모듈로 전면 재편성했다.

### 신규 디렉토리 구조
```
ai_services/
├── prompt_enhancement/    — 쿼리 확장 (의료 용어 정규화, 의도 감지)
│   ├── service.py         — 메인 서비스 (159줄)
│   ├── detector.py        — 의도 감지기 (168줄)
│   ├── expander.py        — 쿼리 확장기 (210줄)
│   ├── medical_normalizer.py — 의료 용어 정규화 (173줄)
│   └── tests/             — 단위 테스트 3개
├── conversation_memory/   — 대화 메모리 (LangGraph 기반)
│   ├── graph/workflow.py  — 워크플로우 (317줄)
│   ├── graph/nodes/       — 6개 노드 (intent, context, reference, query, sql, enricher)
│   ├── checkpointer/      — Postgres/SQLite 체크포인터
│   ├── state/             — 대화 상태 관리
│   └── tests/             — 단위 테스트 3개
└── xiyan_sql/             — XiYan SQL 생성
    ├── schema.py          — OMOP CDM 스키마 정의 (355줄)
    └── schema_linker.py   — 스키마 링커 (207줄)

data_portal/               — 기존 src/api + src/portal 이전
data_pipeline/             — ETL 인프라 스크립트
infra/                     — Docker, nginx, 배포 설정
docs/                      — 기존 doc/ 이전
```

### 핵심 모듈 (PRD AAR-001)
- **Prompt Enhancement**: 한국어 의료 질문 → 확장된 SQL용 쿼리 변환
- **Conversation Memory**: 다중 턴 대화에서 문맥 유지 (이전 질문 참조 해결)
- **XiYan SQL**: OMOP CDM 스키마에 특화된 Text-to-SQL

---

## 2. 데모 기능 구현 + 컴포넌트 리팩토링 `ad2e364`

**70파일 변경 (+87,441 / -1,974)**

시연용 핵심 기능을 구현하고, 800줄 초과 파일 3개를 분리했다.

### 신규 백엔드 라우터
- `routers/datamart.py` — OMOP CDM 테이블 목록/스키마/샘플 데이터 (254줄)
- `routers/imaging.py` — 흉부 X-ray 영상 조회 API (147줄)
- `routers/presentation.py` — Paper2Slides 연동 (238줄)
- `routers/superset.py` — Superset 통계 프록시 (23줄)

### 신규 서비스
- `services/biz_meta.py` — 비즈메타 관리
- `services/it_meta.py` — IT메타 관리
- `scripts/setup_imaging.py` — 영상 데이터 초기 설정

### 프론트엔드 — 신규 페이지/컴포넌트
- `pages/DataGovernance.tsx` — 거버넌스 (리니지 ReactFlow, 비식별화 탭)
- `pages/MedicalNER.tsx` — 의료 NER 데모 (mock 패턴 매칭)
- `components/common/ImageCell.tsx` — X-ray 이미지 셀 (65줄)
- `components/common/ResultChart.tsx` — 쿼리 결과 차트 (424줄)

### 프론트엔드 — 리팩토링 (800줄 초과 파일 분리)
| 원본 | 분리 전 | 분리 후 | 추출 파일 |
|------|---------|---------|-----------|
| DataGovernance | 989줄 | 73줄 | `components/governance/` 7파일 (LineageTab, MetadataTab, DataQualityTab, DeidentificationTab, StandardSecurityTab, helpers, types) |
| DataCatalog | 857줄 | 370줄 | `components/catalog/` 5파일 (TableDetailModal, LineageModal, QualityInfo, RelatedTables, constants) |
| AIAnalysisEnvironment | 847줄 | 323줄 | `components/aienv/` 3파일 (CreateEnvironmentModal, ResourceOverview, TabPanels) |

### DataMart 데이터 교체
- OMOP CDM v5.4 기반 실제 임상 데이터로 교체
- 카드형 목록 UI 적용

### 인프라
- Airflow DAG 설정, Nginx 프록시, Superset 연동 설정 추가
