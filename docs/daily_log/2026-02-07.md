# 2026-02-07 (금) — OMOP ETL 파이프라인 + 버그수정

> 커밋 3건 / +5,724줄 / -2,066줄 / 파일 54개 변경

---

## 1. 실제 OMOP CDM ETL 파이프라인 구현 `44e916d`

**50파일 변경 (+5,549 / -1,933)**

데모용 더미 DAG 4개를 삭제하고, 실제 OMOP CDM 운영에 필요한 ETL DAG 4개를 생성했다.

### 신규 Airflow DAG
| DAG | 기능 | 설명 |
|-----|------|------|
| `condition_era_builder` | condition_occurrence → condition_era | 진단 기록을 기간 단위로 집계 |
| `drug_era_builder` | drug_exposure → drug_era | 투약 기록을 기간 단위로 집계 |
| `data_quality_check` | DQ 검증 | row count, NULL 비율, 날짜 범위, FK 무결성 검사 |
| `stats_summary` | 통계 요약 | cdm_summary 테이블에 테이블별 통계 저장 |

### 신규 백엔드 라우터
- `routers/ai_environment.py` — AI 분석환경 관리 API (487줄)
- `routers/etl.py` — ETL 작업 관리 API (177줄)
- `routers/ner.py` — Medical NER 프록시 (GPU 서버 28100 → /api/v1/ner) (90줄)

### 프론트엔드 개선
- 데이터 관리 메뉴 순서를 워크플로우 기준으로 재배치: ETL → 거버넌스 → 카탈로그 → 데이터마트
- `MainLayout.tsx` — 사이드바 메뉴 구조 변경 (+183줄)
- `AIEnvironment.tsx` — AI 환경 페이지 확장 (+635줄)
- `CDWResearch.tsx` — CDW 연구지원 페이지 개선
- `SettingsContext.tsx` — 사용자 설정 컨텍스트 신규 (60줄)

### 서비스 개선
- `biz_meta.py` — 비즈메타 서비스 확장
- `it_meta.py` — IT메타 서비스 확장 (information_schema 연동)
- `llm_service.py` — LLM 서비스 리팩토링
- `xiyan_sql/schema.py` — OMOP CDM 스키마 업데이트 (+336줄)

---

## 2. SSH 터널·Superset·CORS 에러 수정 `e37bbe6`

**3파일 변경 (+49 / -15)**

운영 중 발생한 연결 에러 3건을 수정했다.

| 문제 | 원인 | 수정 |
|------|------|------|
| NER 503 에러 | SSH 터널(28100) 누락 | `watchdog.sh`에 Medical NER 터널 추가 |
| Superset connection reset | asyncpg 호환성 문제 | `superset.py`: asyncpg → psycopg2 전환 |
| BI 페이지 CORS 에러 | `/api/v1` prefix 누락 | `main.py`: superset 라우터 prefix 추가 |

### 변경 파일
- `infra/watchdog.sh` — NER SSH 터널 추가, JupyterLab 터널 제거 (로컬 Docker 사용)
- `routers/superset.py` — asyncpg → psycopg2 전환 (connection pool 방식 변경)
- `main.py` — governance 라우터 등록 추가

---

## 3. README 업데이트 `59b2e33`

**1파일 변경 (+126 / -118)**

- 프로젝트 현재 상태에 맞게 README 전면 갱신
- 디렉토리 구조, 서비스 목록, 포트 정보 업데이트
