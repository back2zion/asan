# 2026-02-09 (일) — RFP 100% + CSRF 수정 + UI 통일

> 커밋 3건 / +11,044줄 / -4,254줄 / 파일 175개 변경

---

## 1. RFP 100% 고도화 — 보안 미들웨어 + 7개 신규 라우터 `16cce98`

**133파일 변경 (+9,440 / -3,467)**

RFP 자체평가 89% → 100% 달성을 위한 전면 고도화를 수행했다.

### 신규 보안 미들웨어
| 파일 | 기능 |
|------|------|
| `middleware/security_headers.py` | OWASP 보안 헤더 6종 자동 적용 (nosniff, DENY, HSTS, XSS, Referrer, Permissions) |
| `middleware/rate_limit.py` | IP별 Token Bucket Rate Limit (100/min, 1000/hour), 429 + Retry-After |

### 신규 백엔드 라우터 (7개)
| 라우터 | 줄 수 | 기능 |
|--------|-------|------|
| `pipeline_dq.py` | — | 파이프라인 DQ 규칙 관리, 검증 실행, retry/dead-letter 큐 |
| `gov_compliance.py` | 351 | 컴플라이언스 리포트 (HIPAA/개인정보보호법), 보존정책, 감사 CSV 내보내기 |
| `mart_advanced.py` | 254 | Materialized View 생성/새로고침, 종속성 그래프, 스케줄 |
| `ai_experiment.py` | 300 | A/B 테스트 실험 관리, 트래픽 분배, 결과 분석 |
| `cohort_persist.py` | 287 | 코호트 정의 저장/로드/삭제, CSV 내보내기, 코호트 비교 |
| `lakehouse_quality.py` | 342 | 테이블 프로파일링 (null%, distinct, min/max), 스키마 진화 (호환성 체크) |
| `fhir.py` 확장 | 196 | Patient/$everything (6 리소스 번들), Bundle 배치 처리, _include/_sort 파라미터 |

### 기존 라우터 분리/리팩토링
| 변경 | 설명 |
|------|------|
| `ai_ops.py` 634줄 → 분리 | `_ai_ops_shared.py`(297), `ai_ops_audit.py`(142), `ai_ops_safety.py`(191) |
| `datamart.py` 791줄 → 분리 | `_datamart_shared.py`(108), `datamart_analytics.py`(641) |
| `data_design.py` | 시드 데이터 `_data_design_seed.py`(150)로 분리 |
| 포털 운영 | `_portal_ops_health.py`(258) 헬스체크 분리 |

### CSRF 403 전면 수정
프론트엔드 32개+ 파일에서 fetch/axios POST/PUT/DELETE 호출에 CSRF 토큰을 포함하도록 수정했다.
- `apiUtils.ts` — `fetchPost`, `fetchPut`, `fetchDelete` 헬퍼에 `X-CSRF-Token` 자동 포함
- `apiClient` — axios interceptor에 CSRF 쿠키 읽기 추가
- 개별 컴포넌트 32개: 직접 fetch → 공통 헬퍼 전환

### 프론트엔드 개선
| 페이지 | 개선 내용 |
|--------|-----------|
| Dashboard | 레이아웃 편집 실제 적용 (compact/normal/wide 3모드), 레이크하우스 뷰에 진료유형별 분포 차트 추가 |
| DataMart | react-syntax-highlighter 648KB → lazy loading 처리 |
| DataFabric | antd static `message` → `App.useApp()` 수정 (StrictMode 경고 해결) |
| Governance | ReactFlow 컨테이너 width 100% 수정, CatalogManagement 500 에러 수정 |
| AIOps | 단일 파일 → 4탭 분리 (ModelManagement, Audit, Safety, Resource) |

---

## 2. UI 통일 + 성능 최적화 + 오프라인 캐시 `3001d06`

**41파일 변경 (+1,467 / -710)**

프론트엔드 일관성과 안정성을 개선했다.

### 페이지 헤더 통일
5개 페이지의 헤더 스타일을 통일했다 (타이틀, 부제, 아이콘, 여백).
- ETL, DataDesign, DataFabric, Governance, Ontology

### 성능 최적화
- ETL, Governance 페이지에 `React.lazy` 동적 임포트 적용 → 초기 번들 크기 감소
- `apiUtils.ts` GET 응답을 `localStorage`에 캐시 → 서버 다운 시 오프라인 폴백 제공

### 안정화
- 품질 대시보드: `useMemo`로 불필요한 재계산 방지, `forceRender` 상태로 차트 갱신 보장
- `JSON.parse` 에러 처리 강화 (잘못된 캐시 데이터 대응)

### 백엔드 개선
| 파일 | 변경 내용 |
|------|-----------|
| `chat_core.py` | 채팅 응답에 SQL 실행 결과 + 테이블 감지 로직 확장 (+133줄) |
| `datamart_analytics.py` | 분석 쿼리 최적화 (+111줄) |
| `gov_sensitivity.py` | 민감도 분석 리팩토링 |
| `lakehouse.py` | 레이크하우스 쿼리 개선 |
| `catalog_analytics.py` | 카탈로그 분석 쿼리 개선 |

---

## 3. README 업데이트 `8bf11fb`

**1파일 변경 (+137 / -77)**

- 127개 라우터, Milvus/MinIO 벡터DB, 보안 아키텍처 (CSRF, Rate Limit, Security Headers) 반영
- 서비스 포트 정보 업데이트
